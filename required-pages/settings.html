<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthOS - Settings</title>
    <script id="theme-info" src="/api/theme-info.js" data-locked="true"></script>
    <link id="theme-css" rel="stylesheet" href="/api/theme.css" data-locked="true">
    <style>.settings-title{font-size:22px;font-weight:700;min-height:var(--header-min-height);padding:var(--header-padding-vertical) var(--header-padding-horizontal);line-height:var(--header-line-height);display:flex;align-items:center;justify-content:center;box-sizing:border-box;background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));color:#fff;border-radius:12px 12px 0 0;width:100%;max-width:800px;box-shadow:0 6px 25px var(--accent-glow);letter-spacing:2px;text-shadow:0 2px 10px rgba(0,0,0,.3)}.settings-container{display:flex;flex-direction:column;width:100%;max-width:800px;max-height:calc(100vh - 160px);background:rgba(15,15,35,.8);border-radius:0 0 12px 12px;border:1px solid rgba(138,43,226,.2);border-top:none;overflow:hidden}.tab-bar{display:flex;flex-shrink:0;border-bottom:1px solid var(--border-color)}.tab-btn{flex:1;padding:14px 20px;background:0 0;border:none;border-bottom:3px solid transparent;color:var(--text-secondary);font-size:14px;font-weight:600;cursor:pointer;transition:.3s;letter-spacing:.5px}.tab-btn:hover{color:var(--text-primary);background:rgba(138,43,226,.05)}.tab-btn.active{color:var(--text-primary);border-bottom-color:var(--accent-primary)}.tab-content{display:none;flex-direction:column;gap:15px;flex-grow:1;overflow-y:auto;padding:25px}.tab-content.active{display:flex}.form-group{display:flex;flex-direction:column;width:100%}.form-group label{display:block;margin-bottom:8px;color:var(--text-secondary);font-weight:600;font-size:14px}.form-group input,.form-group select,.form-group textarea{width:100%;padding:14px 18px;border-radius:12px;border:1px solid var(--border-color);background:rgba(15,15,35,.8);color:var(--text-primary);font-size:14px;transition:.3s;box-shadow:inset 0 2px 10px rgba(0,0,0,.3)}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:0;border-color:rgba(183,148,246,.6);box-shadow:inset 0 2px 10px rgba(0,0,0,.3),0 0 20px var(--accent-glow)}.form-group input::placeholder,.form-group textarea::placeholder{color:rgba(183,148,246,.5)}.form-group textarea{resize:vertical;min-height:100px}.form-group select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23b794f6' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 15px center}.form-group select option{background:var(--bg-tertiary);color:var(--text-primary);padding:10px}.button-row{display:flex;justify-content:flex-end;padding:15px 25px;border-top:1px solid var(--border-color);flex-shrink:0}.update-btn{padding:12px 30px;border:none;border-radius:12px;font-size:15px;background:linear-gradient(135deg,var(--accent-primary) 0,var(--accent-secondary) 50%,var(--accent-tertiary) 100%);color:#fff;cursor:pointer;transition:.3s;font-weight:600;letter-spacing:1px;box-shadow:0 4px 20px rgba(102,126,234,.4)}.update-btn:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(102,126,234,.6)}.update-btn:active{transform:translateY(0)}.disabled{background:rgba(102,126,234,.2)!important;cursor:not-allowed!important;opacity:.6}.info-text{color:rgba(183,148,246,.7);font-size:13px;line-height:1.6;text-align:center;padding:15px;background:rgba(15,15,35,.4);border-radius:10px;border:1px solid var(--border-color)}.info-text a{color:var(--accent-tertiary);text-decoration:none;transition:.3s;font-weight:500}.info-text a:hover{color:var(--text-secondary);text-shadow:0 0 10px var(--accent-glow)}.filter-bar{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}.filter-btn{padding:6px 14px;border-radius:20px;border:1px solid var(--border-color);background:0 0;color:var(--text-secondary);font-size:13px;cursor:pointer;transition:.2s;white-space:nowrap;flex-shrink:0}.filter-btn:hover{border-color:var(--accent-primary);color:var(--accent-primary)}.filter-btn.active{background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));color:#fff;border-color:transparent}.services-grid{display:grid;grid-template-columns:1fr;gap:12px}.service-card{border-radius:12px;border:1px solid var(--border-color);background:rgba(15,15,35,.5);padding:18px;transition:.3s}.service-card:hover{border-color:rgba(138,43,226,.3)}.service-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.service-card-name{font-size:15px;font-weight:600;color:var(--text-primary)}.service-card-category{font-size:11px;color:var(--text-secondary);background:rgba(138,43,226,.15);padding:2px 8px;border-radius:10px}.service-card-desc{font-size:13px;color:var(--text-secondary);line-height:1.5;margin-bottom:12px}.service-card-fields{display:flex;flex-direction:column;gap:8px}.service-card-fields input{width:100%;padding:10px 14px;border-radius:8px;border:1px solid var(--border-color);background:rgba(15,15,35,.8);color:var(--text-primary);font-size:13px;transition:.3s;box-shadow:inset 0 2px 8px rgba(0,0,0,.2)}.service-card-fields input:focus{outline:0;border-color:rgba(183,148,246,.6);box-shadow:inset 0 2px 8px rgba(0,0,0,.2),0 0 15px var(--accent-glow)}.service-card-fields input::placeholder{color:rgba(183,148,246,.5)}.toggle-switch{position:relative;width:44px;height:24px;flex-shrink:0}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:rgba(100,100,100,.4);border-radius:24px;transition:.3s}.toggle-slider:before{content:"";position:absolute;height:18px;width:18px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:.3s}.toggle-switch input:checked+.toggle-slider{background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary))}.toggle-switch input:checked+.toggle-slider:before{transform:translateX(20px)}.light-mode .settings-container{background:rgba(255,255,255,.8)}.light-mode .tab-btn{color:rgba(107,79,138,.7)}.light-mode .tab-btn:hover{background:rgba(118,75,162,.05);color:var(--text-primary)}.light-mode .tab-btn.active{color:var(--text-primary)}.light-mode .form-group input,.light-mode .form-group select,.light-mode .form-group textarea{background:rgba(255,255,255,.8);box-shadow:inset 0 2px 10px rgba(118,75,162,.05)}.light-mode .form-group input:focus,.light-mode .form-group select:focus,.light-mode .form-group textarea:focus{box-shadow:inset 0 2px 10px rgba(118,75,162,.05),0 0 20px var(--accent-glow)}.light-mode .form-group input::placeholder,.light-mode .form-group textarea::placeholder{color:rgba(107,79,138,.5)}.light-mode .info-text{color:rgba(107,79,138,.7);background:rgba(255,255,255,.4)}.light-mode .service-card{background:rgba(255,255,255,.5)}.light-mode .service-card-fields input{background:rgba(255,255,255,.8);box-shadow:inset 0 2px 8px rgba(118,75,162,.05)}.light-mode .service-card-fields input:focus{box-shadow:inset 0 2px 8px rgba(118,75,162,.05),0 0 15px var(--accent-glow)}.light-mode .service-card-fields input::placeholder{color:rgba(107,79,138,.5)}</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/14.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.1.0/mermaid.min.js"></script>
</head>
<body>
    <div class="chat-panel" data-locked="true">
        <div class="chat-header" data-locked="true">SynthOS</div>
        <div class="chat-messages" id="chatMessages" data-locked="true">
            <div class="chat-message">
                <p><strong>SynthOS:</strong> Please fill in all required fields in the settings form and click 'Update'. Ensure your OpenAI or Anthropic API Key is valid and select the model you wish to use.</p>
                <p><code>Max Output Tokens</code> controls how large of a page that can be rendered and <code>Additional Instructions</code> can be used to provide further prompt instructions for how pages should be updated.</p>
            </div>
        </div>
        <div class="link-group" data-locked="true">
            <a href="#" id="saveLink" data-locked="true">Save</a>
            <a href="/pages" id="pagesLink" data-locked="true">Pages</a>
            <a href="#" id="resetLink" data-locked="true">Reset</a>
        </div>
        <form action="/" method="POST" id="chatForm" data-locked="true">
            <input type="text" class="chat-input" id="chatInput" name="message" placeholder="Type a message..." data-locked="true">
            <button type="submit" class="chat-submit" data-locked="true">Send</button>
        </form>
    </div>
    <div class="viewer-panel" id="viewerPanel" style="justify-content: flex-start; align-items: stretch;">
        <div class="settings-title" style="max-width: none; border-radius: 12px 12px 0 0;">Settings</div>
        <div class="settings-container" style="max-width: none; border-radius: 0; max-height: none; flex-grow: 1;">
            <div class="tab-bar">
                <button class="tab-btn active" data-tab="models">Models</button>
                <button class="tab-btn" data-tab="preferences">Preferences</button>
                <button class="tab-btn" data-tab="services">Services</button>
            </div>
            <div class="tab-content active" id="tab-models">
                <div class="form-group">
                    <label for="serviceApiKey">Service API Key</label>
                    <input type="password" id="serviceApiKey" placeholder="Enter your API Key" required="">
                </div>
                <div class="form-group">
                    <label for="model">Model</label>
                    <select id="model" required="">
                        <option value="">Select a model</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="maxTokens">Max Output Tokens</label>
                    <input type="number" id="maxTokens" placeholder="Enter max token count" required="">
                </div>
                <div class="form-group">
                    <label for="instructions">Additional Instructions</label>
                    <textarea id="instructions" placeholder="Enter any additional instructions"></textarea>
                </div>
                <p class="info-text">An API Key is required which can be generated from either <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI API Keys</a> or <a href="https://console.anthropic.com/settings/keys" target="_blank">Anthropic API Keys</a>.</p>
            </div>
            <div class="tab-content" id="tab-preferences">
                <div class="form-group">
                    <label for="theme">Theme</label>
                    <select id="theme">
                        <option value="">Loading themes...</option>
                    </select>
                </div>
            </div>
            <div class="tab-content" id="tab-services">
                <div class="filter-bar" id="serviceFilterBar"></div>
                <div class="services-grid" id="servicesGrid"></div>
            </div>
            <div class="button-row">
                <button class="update-btn" id="updateBtn">Update</button>
            </div>
        </div>
        <div id="loadingOverlay" class="loading-overlay"><div class="spinner"></div></div>
    </div>
    <div id="instructions" style="display: none;" data-locked="true"></div>
    <div id="thoughts" style="display: none;" data-locked="true"></div>
    <script id="settings-logic">document.querySelectorAll(".tab-btn").forEach(btn=>{btn.addEventListener("click",()=>{document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active")),btn.classList.add("active"),document.getElementById("tab-"+btn.dataset.tab).classList.add("active")})});var serviceRegistry=[],serviceConfigs={},activeServiceCategory="All";function renderServiceFilterBar(){var bar=document.getElementById("serviceFilterBar");bar.innerHTML="";var cats=new Set;serviceRegistry.forEach(function(s){cats.add(s.category)});var sorted=Array.from(cats).sort();["All"].concat(sorted).forEach(function(cat){var btn=document.createElement("button");btn.className="filter-btn"+(activeServiceCategory===cat?" active":""),btn.textContent=cat,btn.addEventListener("click",function(){activeServiceCategory=cat,renderServiceFilterBar(),renderServiceCards()}),bar.appendChild(btn)})}function renderServiceCards(){var grid=document.getElementById("servicesGrid");grid.innerHTML="",serviceRegistry.filter(function(s){return"All"===activeServiceCategory||s.category===activeServiceCategory}).forEach(function(def){var cfg=serviceConfigs[def.id]||{},card=document.createElement("div");card.className="service-card",card.dataset.serviceId=def.id;var header=document.createElement("div");header.className="service-card-header";var nameRow=document.createElement("div");nameRow.style.display="flex",nameRow.style.alignItems="center",nameRow.style.gap="8px";var nameEl=document.createElement("span");nameEl.className="service-card-name",nameEl.textContent=def.name;var catEl=document.createElement("span");catEl.className="service-card-category",catEl.textContent=def.category,nameRow.appendChild(nameEl),nameRow.appendChild(catEl);var toggle=document.createElement("label");toggle.className="toggle-switch";var checkbox=document.createElement("input");checkbox.type="checkbox",checkbox.checked=!!cfg.enabled,checkbox.dataset.serviceId=def.id,checkbox.dataset.field="enabled";var slider=document.createElement("span");slider.className="toggle-slider",toggle.appendChild(checkbox),toggle.appendChild(slider),header.appendChild(nameRow),header.appendChild(toggle),card.appendChild(header);var desc=document.createElement("div");desc.className="service-card-desc",desc.textContent=def.description,card.appendChild(desc);var fields=document.createElement("div");fields.className="service-card-fields",def.fields.forEach(function(f){var input=document.createElement("input");input.type=f.type,input.placeholder=cfg.hasKey?"(key saved â€” leave blank to keep)":f.label,input.dataset.serviceId=def.id,input.dataset.field=f.name,fields.appendChild(input)}),card.appendChild(fields),grid.appendChild(card)})}function collectServicesConfig(){var config={};return serviceRegistry.forEach(function(def){var card=document.querySelector('.service-card[data-service-id="'+def.id+'"]');if(card){var enabled=card.querySelector('input[data-field="enabled"]'),entry={apiKey:"",enabled:!!enabled&&enabled.checked};def.fields.forEach(function(f){var input=card.querySelector('input[data-field="'+f.name+'"]');input&&(entry[f.name]=input.value)}),config[def.id]=entry}}),config}let isConfigured=!1;Promise.all([fetch("/api/settings").then(r=>r.json()),fetch("/api/themes").then(r=>r.json()),fetch("/api/services/registry").then(r=>r.json()),fetch("/api/services").then(r=>r.json())]).then(([data,themes,registry,configs])=>{const serviceApiKey=data.serviceApiKey||"",model=data.model||"",maxTokens=data.maxTokens||"";isConfigured=serviceApiKey&&model&&maxTokens,document.getElementById("serviceApiKey").value=serviceApiKey,document.getElementById("model").innerHTML=data.availableModels.map(m=>`<option value="${m}">${m}</option>`).join(""),document.getElementById("model").value=model,document.getElementById("maxTokens").value=maxTokens,document.getElementById("instructions").value=data.instructions||"";const currentTheme=data.theme||"nebula-dusk";document.getElementById("theme").innerHTML=themes.map(t=>`<option value="${t}">${t}</option>`).join(""),document.getElementById("theme").value=currentTheme,serviceRegistry=registry,serviceConfigs=configs,renderServiceFilterBar(),renderServiceCards(),isConfigured||(document.getElementById("chatInput").disabled=!0,document.getElementById("chatInput").classList.add("disabled"))}).catch(error=>console.error("Error fetching settings:",error)),document.getElementById("updateBtn").addEventListener("click",()=>{const serviceApiKey=document.getElementById("serviceApiKey").value,model=document.getElementById("model").value,maxTokens=document.getElementById("maxTokens").value;if(!serviceApiKey||!model||!maxTokens)return void alert("Please fill in all required fields (API Key, Model, Max Output Tokens).");const body={serviceApiKey:serviceApiKey,model:model,maxTokens:maxTokens,instructions:document.getElementById("instructions").value,theme:document.getElementById("theme").value};var servicesBody=collectServicesConfig();Promise.all([fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)}),fetch("/api/services",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(servicesBody)})]).then(function(responses){responses.every(function(r){return r.ok||r.redirected})?window.location.reload():alert("Failed to save settings. Please try again.")}).catch(err=>{console.error("Error saving settings:",err),alert("Failed to save settings. Please try again.")})});</script>
<script id="page-helpers" src="/api/page-helpers.js?v=2" data-locked="true"></script>
<script id="page-script" src="/api/page-script.js?v=2" data-locked="true"></script>
</body></html>