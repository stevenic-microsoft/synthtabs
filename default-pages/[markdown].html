<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthOS</title>
    <style>
        /* Nebula Dusk Theme */
        :root { --bg-primary:#1a1a2e; --bg-secondary:#16213e; --bg-tertiary:#0f0f23; --accent-primary:#667eea; --accent-secondary:#764ba2; --accent-tertiary:#f093fb; --accent-glow:rgba(138,43,226,0.3); --text-primary:#e0e0e0; --text-secondary:#b794f6; --border-color:rgba(138,43,226,0.3); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%); color: var(--text-primary); height: 100vh; display: flex; }
        .chat-panel { width: 30%; background: linear-gradient(180deg, rgba(26, 26, 46, 0.95) 0%, rgba(22, 33, 62, 0.95) 100%); box-shadow: 0 0 30px var(--accent-glow), inset 0 0 60px rgba(75, 0, 130, 0.1); padding: 20px; display: flex; flex-direction: column; border-right: 1px solid var(--border-color); }
        .chat-header { font-size: 24px; padding: 15px; background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, var(--accent-tertiary) 100%); color: white; text-align: center; border-radius: 15px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); letter-spacing: 2px; }
        .chat-messages { flex-grow: 1; overflow-y: auto; padding: 15px; margin-top: 15px; background: rgba(15, 15, 35, 0.6); border-radius: 15px; border: 1px solid var(--border-color); box-shadow: inset 0 0 30px rgba(75, 0, 130, 0.2); }
        .chat-message { margin-bottom: 15px; padding: 12px 15px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%); border-radius: 15px; box-shadow: 0 2px 10px var(--accent-glow); border: 1px solid rgba(138, 43, 226, 0.1); backdrop-filter: blur(5px); }
        .chat-message p { margin-bottom: 5px; line-height: 1.5; }
        .chat-message p strong { font-weight: 600; background: linear-gradient(90deg, var(--accent-primary), var(--accent-tertiary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .chat-message p code { background: rgba(138, 43, 226, 0.3); padding: 2px 6px; border-radius: 5px; font-family: 'Courier New', Courier, monospace; color: var(--accent-tertiary); border: 1px solid rgba(240, 147, 251, 0.3); }
        .link-group { display: flex; justify-content: space-between; margin: 15px 0; padding: 10px; background: rgba(15, 15, 35, 0.4); border-radius: 10px; border: 1px solid var(--border-color); }
        .link-group a { font-size: 14px; color: var(--text-secondary); text-decoration: none; padding: 8px 15px; border-radius: 8px; transition: all 0.3s ease; border: 1px solid transparent; }
        .link-group a:hover { background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%); border-color: rgba(183, 148, 246, 0.5); box-shadow: 0 0 15px var(--accent-glow); color: var(--accent-tertiary); }
        form { display: flex; flex-direction: row; width: 100%; gap: 10px; align-items: center; }
        .chat-input { padding: 14px 18px; border: 1px solid var(--border-color); border-radius: 25px; flex-grow: 1; font-size: 14px; background: rgba(15, 15, 35, 0.8); color: var(--text-primary); box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3), 0 0 20px rgba(138, 43, 226, 0.1); transition: all 0.3s ease; }
        .chat-input:focus { outline: none; border-color: rgba(183, 148, 246, 0.6); box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3), 0 0 25px var(--accent-glow); }
        .chat-input::placeholder { color: rgba(183, 148, 246, 0.5); }
        .chat-submit { padding: 14px 20px; border: none; border-radius: 25px; font-size: 14px; background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, var(--accent-tertiary) 100%); color: white; cursor: pointer; transition: all 0.3s ease; font-weight: 600; letter-spacing: 1px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); white-space: nowrap; }
        .chat-submit:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6); }
        .chat-submit:active { transform: translateY(0); }
        .viewer-panel { width: 70%; padding: 25px; background: linear-gradient(135deg, rgba(22, 33, 62, 0.9) 0%, rgba(15, 15, 35, 0.95) 100%); display: flex; flex-direction: column; justify-content: flex-start; align-items: center; box-shadow: inset 0 0 60px rgba(75, 0, 130, 0.15); position: relative; overflow: auto; }
        .viewer-panel::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(ellipse at center, rgba(138, 43, 226, 0.05) 0%, transparent 70%); animation: nebula-pulse 8s ease-in-out infinite; pointer-events: none; }
        @keyframes nebula-pulse { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.1); } }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 15, 35, 0.9); justify-content: center; align-items: center; z-index: 1000; }
        .spinner { width: 50px; height: 50px; border: 4px solid var(--border-color); border-top-color: var(--accent-tertiary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: rgba(15, 15, 35, 0.6); border-radius: 10px; border: 1px solid var(--border-color); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, var(--accent-tertiary) 100%); border-radius: 10px; border: 2px solid rgba(15, 15, 35, 0.6); box-shadow: 0 0 10px var(--accent-glow); }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, var(--accent-tertiary) 0%, var(--accent-secondary) 50%, var(--accent-primary) 100%); }
        ::-webkit-scrollbar-corner { background: rgba(15, 15, 35, 0.6); }
        * { scrollbar-width: thin; scrollbar-color: var(--accent-secondary) rgba(15, 15, 35, 0.6); }

        /* Markdown Nebula Theme */
        .markdown-content { text-align: left; color: var(--text-primary); width: 100%; max-width: 800px; margin: 0 auto; line-height: 1.7; position: relative; z-index: 1; }
        .markdown-content h1, .markdown-content h2, .markdown-content h3, .markdown-content h4, .markdown-content h5 { background: linear-gradient(90deg, var(--accent-primary), var(--accent-tertiary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 1.2em 0 0.6em; font-weight: 700; }
        .markdown-content h1 { font-size: 2.2em; border-bottom: 2px solid var(--border-color); padding-bottom: 0.3em; text-shadow: 0 0 30px var(--accent-glow); }
        .markdown-content h2 { font-size: 1.8em; }
        .markdown-content h3 { font-size: 1.4em; }
        .markdown-content p { margin-bottom: 1em; color: rgba(224, 224, 224, 0.9); }
        .markdown-content ul, .markdown-content ol { margin: 0 0 1em 20px; }
        .markdown-content li { margin-bottom: 0.4em; color: rgba(224, 224, 224, 0.85); }
        .markdown-content li::marker { color: var(--accent-tertiary); }
        .markdown-content blockquote { margin: 1em 0; padding: 12px 20px; border-left: 4px solid var(--accent-secondary); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 0 10px 10px 0; font-style: italic; color: var(--text-secondary); }
        .markdown-content code { background: rgba(138, 43, 226, 0.25); padding: 3px 7px; border-radius: 5px; font-family: 'Fira Code', 'Courier New', monospace; color: var(--accent-tertiary); border: 1px solid rgba(240, 147, 251, 0.2); font-size: 0.9em; }
        .markdown-content pre { background: transparent !important; padding: 0; margin: 0; }
        .markdown-content .code-block { border-radius: 12px; overflow: hidden; margin: 1em 0; border: 1px solid var(--border-color); box-shadow: 0 4px 20px var(--accent-glow); }
        .markdown-content .code-block pre { margin: 0; padding: 15px; background: rgba(15, 15, 35, 0.9) !important; }
        .markdown-content .code-block code { background: transparent; border: none; padding: 0; color: inherit; }
        .markdown-content a { color: var(--accent-tertiary); text-decoration: none; border-bottom: 1px solid transparent; transition: all 0.3s; }
        .markdown-content a:hover { border-bottom-color: var(--accent-tertiary); text-shadow: 0 0 10px var(--accent-glow); }
        .markdown-content table { width: 100%; border-collapse: collapse; margin: 1em 0; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px var(--accent-glow); }
        .markdown-content th { padding: 12px 15px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; font-weight: 600; text-align: left; }
        .markdown-content td { padding: 10px 15px; background: rgba(15, 15, 35, 0.6); border-top: 1px solid var(--border-color); }
        .markdown-content tr:hover td { background: rgba(102, 126, 234, 0.15); }
        .markdown-content img { max-width: 100%; border-radius: 12px; margin: 1em auto; display: block; box-shadow: 0 4px 25px var(--accent-glow); border: 1px solid var(--border-color); }
        .markdown-content hr { border: none; height: 2px; background: linear-gradient(90deg, transparent, var(--accent-secondary), var(--accent-tertiary), var(--accent-secondary), transparent); margin: 2em 0; }
        .markdown-content input[type="checkbox"] { accent-color: var(--accent-tertiary); margin-right: 8px; }
        .code-header { background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3)); padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
        .code-header span { font-size: 0.85em; color: var(--text-secondary); font-weight: 500; }
        .copy-button { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); border: none; color: white; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8em; transition: all 0.3s; }
        .copy-button:hover { box-shadow: 0 0 15px var(--accent-glow); transform: translateY(-1px); }    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/14.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.1.0/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.10.0/highlight.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.10.0/styles/night-owl.min.css" rel="stylesheet">
</head>
<body>
    <div class="chat-panel">
        <div class="chat-header">SynthOS</div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message"><p><strong>SynthOS:</strong> what document can I write for you?</p></div>
        </div>
        <div class="link-group">
            <a href="#" id="saveLink">Save</a>
            <a href="/pages" id="pagesLink">Pages</a>
            <a href="#" id="resetLink">Reset</a>
        </div>
        <form action="/" method="POST" id="chatForm">
            <input type="text" class="chat-input" id="chatInput" name="message" placeholder="Type a message...">
            <button type="submit" class="chat-submit">Send</button>
        </form>
    </div>
    <div class="viewer-panel" id="viewerPanel">
        <div class="markdown-content" id="markdownContent">
            <!-- The markdown content will be rendered here -->
        </div>
    </div>
    <div id="thoughts" style="display: none;">I've prompted the user for the document to write.</div>
    <div id="loadingOverlay" class="loading-overlay"><div class="spinner"></div></div>
    <script>
        // Basic chat functionality
        document.getElementById("chatInput").focus();
        document.getElementById("chatForm").addEventListener('submit', () => {
            document.getElementById("loadingOverlay").style.display = 'flex';
            document.getElementById("chatForm").action = window.location.pathname;
        });
        document.getElementById("saveLink").addEventListener("click", function() {
            const pageName = prompt("Enter the name of the page to save as:");
            if (pageName) {
                window.location.href = `${window.location.pathname}/save?name=${encodeURIComponent(pageName)}`;
            }
        });
        document.getElementById("resetLink").addEventListener("click", function() {
            window.location.href = `${window.location.pathname}/reset`;
        });
        window.onload = function() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTo({
                top: chatMessages.scrollHeight,
                behavior: 'smooth'
            });

            // Render markdown using marked library with custom renderer
            const renderer = new marked.Renderer();
            renderer.code = function(code) {
                const validLanguage = !!(code.lang && hljs.getLanguage(code.lang));
                const highlighted = validLanguage ? hljs.highlight(code.lang, code.text).value : code.text;
                console.log(highlighted);
                return `<div class="code-block">
                            <div class="code-header">
                                <span>${code.lang || 'plaintext'}</span>
                                <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
                            </div>
                            <pre><code class="${code.lang}">${highlighted}</code></pre>
                        </div>`;
            };

            marked.setOptions({
                renderer: renderer,
                highlight: function(code) {
                    const validLanguage = !!(code.lang && hljs.getLanguage(code.lang));
                    return validLanguage ? hljs.highlight(code.lang, code.text).value : code.textS;
                }
            });

            document.getElementById('markdownContent').innerHTML = marked.parse(markdownContent);

            // Initialize mermaid
            mermaid.initialize({ startOnLoad: true, theme: 'dark' });
            mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
        };
            
        function copyToClipboard(button) {
            const codeBlock = button.parentElement.nextElementSibling.querySelector('code');
            navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => { button.textContent = 'Copy'; }, 2000);
            });
        }

        // Markdown content to render
        const markdownContent = `# SynthOS's Markdown Showcase

This page demonstrates various markdown elements and how they are styled in our custom theme.

## Text Formatting

You can make text **bold**, *italic*, or ***both***. You can also use ~~strikethrough~~ for deleted text.

## Lists

### Unordered List

- Item 1
- Item 2
  - Subitem 2.1
  - Subitem 2.2
- Item 3

### Ordered List

1. First item
2. Second item
3. Third item
   1. Subitem 3.1
   2. Subitem 3.2

## Links and Images

You can create [links to websites](https://www.example.com) or add images:

![Sample Image](https://via.placeholder.com/300x200.png?text=Sample+Image)

## Blockquotes

> This is a blockquote. It's great for highlighting important information or quoting sources.

## Code Blocks

Inline code: \`console.log('Hello, World!');\`

Code block:

\`\`\`javascript
function greet(name) {
  return \`Hello, \${name}!\`;
}

console.log(greet('SynthOS'));
\`\`\`

## Tables

| Header 1 | Header 2 | Header 3 |
|----------|----------|----------|
| Row 1, Col 1 | Row 1, Col 2 | Row 1, Col 3 |
| Row 2, Col 1 | Row 2, Col 2 | Row 2, Col 3 |

## Horizontal Rule

---

## Task Lists

- [x] Complete task
- [ ] Incomplete task
- [ ] Another task

## Mermaid Diagrams

\`\`\`mermaid
graph TD
    A[Start] --> B{Is it?}
    B -- Yes --> C[OK]
    C --> D[Rethink]
    D --> B
    B -- No ----> E[End]
\`\`\`

This showcase demonstrates the various markdown elements and how they are styled in our custom theme. Feel free to use these examples as a reference when creating your own markdown content!

## Additional Content for Scrolling

To demonstrate the scrolling functionality, we've added some extra content below.

### Lorem Ipsum

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nunc id aliquam tincidunt, nisl nunc tincidunt nunc, vitae aliquam nunc nunc vitae nunc. Sed euismod, nunc id aliquam tincidunt, nisl nunc tincidunt nunc, vitae aliquam nunc nunc vitae nunc.

### Code Example

Here's another code example to show how syntax highlighting works with scrolling:

\`\`\`python
def fibonacci(n):
    if n <= 1:
        return n
    else:
        return fibonacci(n-1) + fibonacci(n-2)

# Print the first 10 Fibonacci numbers
for i in range(10):
    print(fibonacci(i))
\`\`\`

### Final Thoughts

This extended markdown content demonstrates how the viewer panel now scrolls independently of the chat panel, allowing users to read through longer documents while still having access to the chat functionality.`;
    </script>
</body>
</html>