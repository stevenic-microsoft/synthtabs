<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthOS - {Application Title}</title>
    <script src="/api/theme-info.js"></script>
    <link rel="stylesheet" href="/api/theme.css">
    <style>
        /* Page Specific Styles */
        .application-title {
            font-size: 22px;
            font-weight: 700;
            min-height: var(--header-min-height);
            padding: var(--header-padding-vertical) var(--header-padding-horizontal);
            line-height: var(--header-line-height);
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-radius: 12px 12px 0 0;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 6px 25px var(--accent-glow);
        }

        .application-content {
            font-size: 14px;
            color: rgba(224, 224, 224, 0.8);
            padding: 20px;
            flex-grow: 1;
            width: 100%;
            max-width: 800px;
            background: rgba(15, 15, 35, 0.8);
            border-radius: 0 0 12px 12px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-top: none;
        }

        /* Light-mode overrides */
        .light-mode .application-content {
            color: rgba(45, 38, 64, 0.8);
            background: rgba(255, 255, 255, 0.8);
        }
        #loadingOverlay { position: absolute; }
        .chat-submit:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .chat-input:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/14.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.1.0/mermaid.min.js"></script>
</head>

<body>
    <div class="chat-panel">
        <div class="chat-header">SynthOS</div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message">
                <p><strong>SynthOS:</strong> what kind of application would you like?</p>
            </div>
        </div>
        <div class="link-group">
            <a href="#" id="saveLink">Save</a>
            <a href="/pages" id="pagesLink">Pages</a>
            <a href="#" id="resetLink">Reset</a>
        </div>
        <form action="/" method="POST" id="chatForm">
            <input type="text" class="chat-input" id="chatInput" name="message" placeholder="Type a message...">
            <button type="submit" class="chat-submit">Send</button>
        </form>
    </div>
    <div class="viewer-panel" id="viewerPanel">
        <div class="application-title" style="max-width: none;">{Application Title}</div>
        <div class="application-content" style="max-width: none;">{Application Content}</div>
        <div id="loadingOverlay" class="loading-overlay"><div class="spinner"></div></div>
    </div>
    <div id="thoughts" style="display: none;">The user wants the application containers to span the full width of the
        viewer panel. I've removed the max-width: 800px constraint from both the application-title and
        application-content elements by setting max-width: none inline. The viewer panel already has padding
        (var(--viewer-padding)), so the application will naturally respect that padding while filling the available
        width.</div>
    <script>
        // Basic chat functionality
        document.getElementById("chatInput").focus();
        document.getElementById("chatForm").addEventListener('submit', () => {
            document.getElementById("loadingOverlay").style.display = 'flex';
            document.getElementById("chatForm").action = window.location.pathname;
            setTimeout(() => {
                document.getElementById("chatInput").disabled = true;
                document.querySelector(".chat-submit").disabled = true;
                document.querySelectorAll(".link-group a").forEach(a => {
                    a.style.pointerEvents = 'none';
                    a.style.opacity = '0.5';
                });
            }, 50);
        });
        document.getElementById("saveLink").addEventListener("click", function () {
            const pageName = prompt("Enter the name of the page to save as:");
            if (pageName) {
                window.location.href = `${window.location.pathname}/save?name=${encodeURIComponent(pageName)}`;
            }
        });
        document.getElementById("resetLink").addEventListener("click", function () {
            window.location.href = `${window.location.pathname}/reset`;
        });
        window.onload = function () {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTo({
                top: chatMessages.scrollHeight,
                behavior: 'smooth'
            });
        };

        // Chat panel toggle
        (function() {
            const btn = document.createElement('button');
            btn.className = 'chat-toggle';
            btn.setAttribute('aria-label', 'Toggle chat panel');
            const dots = document.createElement('span');
            dots.className = 'chat-toggle-dots';
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('span');
                dot.className = 'chat-toggle-dot';
                dots.appendChild(dot);
            }
            btn.appendChild(dots);
            document.body.appendChild(btn);

            const STORAGE_KEY = 'synthos-chat-collapsed';

            // Restore persisted state
            if (localStorage.getItem(STORAGE_KEY) === 'true') {
                document.body.classList.add('chat-collapsed');
            }

            btn.addEventListener('click', function() {
                document.body.classList.toggle('chat-collapsed');
                localStorage.setItem(STORAGE_KEY, document.body.classList.contains('chat-collapsed'));
            });
        })();

        // Focus management â€” prevent viewer content from stealing keystrokes
        (function() {
            const chatInput = document.getElementById('chatInput');
            const viewerPanel = document.getElementById('viewerPanel');

            chatInput.addEventListener('mousedown', function(e) {
                e.stopPropagation();
            });

            ['keydown', 'keyup', 'keypress'].forEach(type => {
                document.addEventListener(type, function(e) {
                    if (document.activeElement === chatInput) {
                        e.stopImmediatePropagation();
                    }
                }, true);
            });

            viewerPanel.setAttribute('tabindex', '-1');
            chatInput.addEventListener('blur', function() {
                viewerPanel.focus();
            });
        })();
    </script>

</body>

</html>